# RoboCar-A: 基于 ESP32-S3 的智能小车控制系统

RoboCar-A 是一个集成了 Flutter 移动端应用与 ESP32-S3 固件的综合性智能小车控制方案。支持麦克纳姆轮全向移动、实时遥测数据监控、OTA 固件更新以及丰富的硬件控制接口。

## 🌟 核心特性

- **全向移动控制**：完美支持麦克纳姆轮（Mecanum Wheel），实现前后、左右平移及原地自旋。
- **实时数据遥测**：
  - **超声波避障**：经过优化的滤波算法（五点中值+均值滤波），精度达 ±0.1cm，实时反馈前方障碍物距离。
  - **电池电压监控**：实时采集动力电池电压，确保设备运行安全。
  - **信号强度反馈**：实时监控 WiFi RSSI 信号强度。
- **OTA 无线升级**：支持通过移动端 App 直接上传 `.bin` 固件，实现无线更新。
- **多功能控制**：
  - **灯光与喇叭**：通过 App 远程控制小车照明及警示音。
  - **舵机云台**：集成 PCA9685 驱动，支持多路舵机（如云台、机械臂）的精细控制。
- **自动设备发现**：基于 mDNS 协议，App 自动发现局域网内的 RoboCar-A 设备，无需手动输入 IP。
- **赛博朋克 UI**：HUD 风格的暗色调设计，提供极佳的操控沉浸感。

## 🛠️ 硬件配置 (ESP32-S3)

### 电机驱动 (麦克纳姆轮)
| 电机 | 功能 | GPIO 引脚 |
|-------|----------|----------|
| **左前 (M1)** | PWM | 14 |
| | 方向 (IN1/IN2) | 2 / 13 |
| **右前 (M2)** | PWM | 4 |
| | 方向 (IN1/IN2) | 5 / 6 |
| **左后 (M3)** | PWM | 7 |
| | 方向 (IN1/IN2) | 15 / 16 |
| **右后 (M4)** | PWM | 17 |
| | 方向 (IN1/IN2) | 18 / 8 |

### 传感器与外设
| 组件 | 功能 | GPIO 引脚 |
|-----------|----------|----------|
| **超声波** | Trig / Echo | 9 / 10 |
| **PCA9685 (I2C)** | SDA / SCL | 11 / 12 |
| **照明灯** | 输出控制 | 2 |
| **喇叭** | 输出控制 | 3 |
| **电池电压检测** | ADC 输入 | 1 (ADC1_CH0) |

## 🚀 软件快速上手

### 1. 固件编译与烧录 (ESP-IDF)
**前提条件**：安装 ESP-IDF v5.3.1 或更高版本。

1. 进入固件目录：
   ```bash
   cd firmware/esp32_smart_car_idf
   ```
2. 编译并烧录：
   ```bash
   idf.py build flash monitor
   ```
   *注意：生成的固件位于 `build/esp32_smart_car.bin`*

### 2. App 运行 (Flutter)
**前提条件**：安装 Flutter SDK (推荐 3.10.7+)。

1. 安装依赖：
   ```bash
   flutter pub get
   ```
2. 运行 App：
   ```bash
   flutter run
   ```

## 📡 通信协议

设备通过 WebSocket (默认端口 80) 进行实时通信。
- **移动控制**: `{"cmd": "move", "vx": float, "vy": float, "vw": float}`
- **舵机控制**: `{"cmd": "servo", "channel": int, "angle": float}`
- **硬件控制**: `{"cmd": "light", "value": int}`, `{"cmd": "horn", "value": int}`

## 📝 维护与开发

- **名称统一**：项目已统一命名为 **RoboCar-A**，修改时请保持一致。
- **算法优化**：
  - 电机控制已加入软启动/平滑加减速逻辑，提升行驶稳定性。
  - 超声波检测采用多采样滤波，有效消除硬件抖动。

---
*本项目仅供学习与交流使用。*
